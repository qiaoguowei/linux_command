
DROP TABLE IF EXISTS 'dislock';
CREATE TABLE 'dislock' (
    'id' int(11) unsigned NOT NULL COMMENT '主键',
    'lock_type' varchar(64) NOT NULL COMMENT '锁类型',
    'owner_id' varchar(255) NOT NULL COMMENT '持锁对象',
    'update_time' timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY ('id'), #非空唯一约束
    UNIQUE KEY 'idx_lock_type' ('lock_type') #不会出现重复
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8 COMMENT='分布式锁表';


innodb中的S锁和X锁互斥
    select * from lock where ...lock in share mode;

加锁：
    insert into dislock ('lock_type', 'owner_id') values ('act_lock', 'ad2daf3');

解锁：
    delete from dislock where 'lock_type' = 'act_lock' and 'owner_id' = 'ad2daf3';

超进程解锁
    delete from dislock where 'lock_type' = 'act_lock' and 'update_time' < date_sub(now(), interval 30 seconds);;
    
mysql 只能实现非公平锁

mysql计算和存储是在一起的，在一个进程中
